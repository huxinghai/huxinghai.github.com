<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: ruby | Ka Ka Blog]]></title>
  <link href="http://huxinghai1988.github.com/blog/categories/ruby/atom.xml" rel="self"/>
  <link href="http://huxinghai1988.github.com/"/>
  <updated>2016-09-07T21:53:53+08:00</updated>
  <id>http://huxinghai1988.github.com/</id>
  <author>
    <name><![CDATA[kaka]]></name>
    <email><![CDATA[huxinghai1988@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[使用Ruby MonitorMixin注意的坑]]></title>
    <link href="http://huxinghai1988.github.com/blog/2016/08/20/ruby-monitor-mixin/"/>
    <updated>2016-08-20T21:40:00+08:00</updated>
    <id>http://huxinghai1988.github.com/blog/2016/08/20/ruby-monitor-mixin</id>
    <content type="html"><![CDATA[<p>初次使用MonitorMixin控制同步执行的时候一不小心就踩坑了，当你include的时候如果你的class定义了initialize方法
请调用<code>super</code>否则会报<code>undefined method `lock' for nil:NilClass</code>错。</p>

<p>```ruby</p>

<pre><code>class Number
  attr_accessor :n

  include MonitorMixin

  def initialize(*args)
    @n = 0
    super() # 调用MonitorMixin#initialize
  end

  def increase(x)
    synchronize do 
      @n = @n + x
      puts("#{@n}, #{x}")
    end
  end
end
</code></pre>

<p>```</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[El Capitan ruby-oci8 2.1.4 安装报错]]></title>
    <link href="http://huxinghai1988.github.com/blog/2016/01/01/el-capitan-ruby-oci8/"/>
    <updated>2016-01-01T16:31:00+08:00</updated>
    <id>http://huxinghai1988.github.com/blog/2016/01/01/el-capitan-ruby-oci8</id>
    <content type="html"><![CDATA[<p>升级MacOS El Capitan后安装oracle的ruby-oci8 2.1.4版本gem包报错信息如下</p>

<p>```
  Installing ruby-oci8 2.1.4 with native extensions</p>

<p>  Gem::Ext::BuildError: ERROR: Failed to build gem native extension.</p>

<p>  /Users/huxinghai/.rvm/rubies/ruby-2.0.0-p643/bin/ruby -r ./siteconf20151231-1172-1r9gor0.rb extconf.rb
  checking for load library path...
  DYLD_LIBRARY_PATH is not set.
  checking for cc... ok
  checking for gcc... yes
  checking for LP64... yes
  checking for sys/types.h... yes
  checking for ruby header... ok
  Get the version of Oracle from SQL<em>Plus... 1120
  try  -I/opt/oracle/instantclient_11_2/rdbms/public
  checking for oci.h... no
  try  -I/opt/oracle/instantclient_11_2/rdbms/public -I/opt/oracle/instantclient_11_2/rdbms/demo
  checking for oci.h... no
  try  -I/opt/oracle/instantclient_11_2/rdbms/public -I/opt/oracle/instantclient_11_2/rdbms/demo -I/opt/oracle/instantclient_11_2/network/public
  checking for oci.h... no
  try  -I/opt/oracle/instantclient_11_2/rdbms/public -I/opt/oracle/instantclient_11_2/rdbms/demo -I/opt/oracle/instantclient_11_2/network/public -I/opt/oracle/instantclient_11_2/plsql/public
  checking for oci.h... no
  </em><strong> extconf.rb failed </strong>*
  Could not create Makefile due to some reason, probably lack of necessary
  libraries and/or headers.
```</p>

<p>这里面有一个重要的信息<code>DYLD_LIBRARY_PATH is not set</code>但是我在<code>~/.bash_profile</code>文件里面配置了DYLD_LIBRARY_PATH路径，我在终端<code>env | grep DYLD_LIBRARY_PATH</code>但是为空，后来我在终端<code>export DYLD_LIBRARY_PATH=/opt/oracle/instantclient_11_2</code>还是为空，但是export其它的环境变量都有值，后来查资料看到一个El Capitan SIP（System Integrity Protection）这个词，google了一个SIP才明白是El Capitan版本的一个安全策略, SIP把DYLD_LIBRARY_PATH保护起来了，所以的把SIP关闭才可以正常设置DYLD_LIBRARY_PATH, 关闭SIP后export DYLD_LIBRARY_PATH变量就成功了。</p>

<p><a href="http://apple.stackexchange.com/questions/208478/how-do-i-disable-system-integrity-protection-sip-aka-rootless-on-os-x-10-11">关闭SIP步骤</a></p>

<ol>
<li>重启系统, 在启动时候按<code>Command+R</code>进入恢复模式图形界面</li>
<li>点击<code>使用工具</code> > <code>Terminal</code></li>
<li>在终端输入<code>csrutil disable</code>命令按回车，会提示是否成功</li>
<li>重启系统</li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[元编程Ruby2.0 Module#refine]]></title>
    <link href="http://huxinghai1988.github.com/blog/2015/11/08/module-refine/"/>
    <updated>2015-11-08T00:00:00+08:00</updated>
    <id>http://huxinghai1988.github.com/blog/2015/11/08/module-refine</id>
    <content type="html"><![CDATA[<p>没有看元编程第二版之前还不知道Module有<strong><em>refine</em></strong>特效，可以将一个class重新打开定义方法
然后使用using生效，这样不会影响原有class，下面我们看看这个案例：</p>

<p>```ruby</p>

<pre><code>module FooBar
  refine String do
    def hello
      puts "#{self} says : Hello, world"
    end
  end
end

class Bar
  using FooBar
  attr_reader :user

  def initialize(user)
    @user = user
  end

  def say
    user.hello
  end
end

Bar.new('ruby').say
String.new.say
</code></pre>

<p>```</p>

<p>String.new.say调用会报错， 因为say只在Bar类里面生效。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ruby根据不同的异常处理不同事件]]></title>
    <link href="http://huxinghai1988.github.com/blog/2014/07/28/rails-raise/"/>
    <updated>2014-07-28T23:39:00+08:00</updated>
    <id>http://huxinghai1988.github.com/blog/2014/07/28/rails-raise</id>
    <content type="html"><![CDATA[<p>在一个<em>class</em>里面你想根据不同的异常回调不同事件</p>

<pre><code>class NoMoneyException &lt; StandardError
end

class ValidNumberException &lt; StandardError
end

class Sale

    def self.create(options)
        obj = new(options)
        obj.validation
    end

    def validation

        raise NoMoneyException if money &gt; current_user.money
        raise ValidNumberException if number &gt; warehouse.nventory
    end
end


begin
    Sale.create({...})
rescue NoMoneyException =&gt; e
    callback ..
rescue ValidNumberException =&gt; e
    callback ..
end
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ruby 2.0三个重要特性实例收藏]]></title>
    <link href="http://huxinghai1988.github.com/blog/2013/06/22/ruby2-0/"/>
    <updated>2013-06-22T00:36:00+08:00</updated>
    <id>http://huxinghai1988.github.com/blog/2013/06/22/ruby2-0</id>
    <content type="html"><![CDATA[<ul>
<li><a href="http://dev.af83.com/2012/10/19/ruby-2-0-module-prepend.html">Module#prepend</a></li>
<li><a href="http://dev.af83.com/2012/10/19/ruby-2-0-module-prepend.html">Module#refine</a></li>
<li><a href="http://dev.af83.com/2013/02/18/ruby-2-0-keyword-arguments.html">Keyword arguments</a></li>
</ul>

]]></content>
  </entry>
  
</feed>
